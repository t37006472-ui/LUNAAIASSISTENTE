<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luna IA ‚Ä¢ Sua Namorada Virtual</title>
  <meta name="theme-color" content="#ff00c3" />
  
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"Luna IA\",
    \"short_name\":\"Luna\",
    \"start_url\":\".\",
    \"display\":\"standalone\",
    \"background_color\":\"#0f0f1a\",
    \"theme_color\":\"#ff00c3\",
    \"icons\":[{\"src\":\"https://raw.githubusercontent.com/rafabene/luna-ia/main/icon.png\",\"sizes\":\"512x512\",\"type\":\"image/png\"}]
  }" />
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
    
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: linear-gradient(135deg, #0f0f1a, #1a0033);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      text-align: center;
      padding: 20px;
    }
    .luna {
      width: 280px;
      height: 280px;
      margin: 0 auto 30px;
      object-fit: contain;
    }
    h1 {
      font-size: 32px;
      background: linear-gradient(90deg, #ff00c3, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    .status {
      font-size: 18px;
      margin: 20px 0;
      min-height: 60px;
      color: #ccc;
      padding: 0 10px;
    }
    .mic {
      width: 80px;
      height: 80px;
      background: #ff00c3;
      border-radius: 50%;
      margin: 40px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 40px #ff00c3aa;
      transition: all 0.3s;
    }
    .mic:active { transform: scale(0.9); }
    .mic.pulsing { animation: pulse 1.5s infinite; }
    @keyframes pulse {
      0% { box-shadow: 0 0 40px #ff00c3aa; }
      50% { box-shadow: 0 0 80px #ff00c3ff; }
      100% { box-shadow: 0 0 40px #ff00c3aa; }
    }
    .footer {
      position: fixed;
      bottom: 20px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="https://raw.githubusercontent.com/rafabene/luna-ia/main/luna.gif" alt="Luna" class="luna" id="lunaImg">
    <h1>Luna IA</h1>
    <div class="status" id="status">Toque no microfone e fale comigo, meu amor ‚ù§Ô∏è</div>
    <div class="mic" id="micBtn">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
    </div>
    <div class="footer">Feito com amor por T√°rcio ‚Ä¢ Vers√£o Web 3.0</div>
  </div>

  <script>
    const status = document.getElementById('status');
    const micBtn = document.getElementById('micBtn');
    const lunaImg = document.getElementById('lunaImg');
    
    let recognition;
    let isListening = false;
    let saudacaoFeita = false;
    let nomeUsuario = localStorage.getItem('nomeLuna') || null;
    let modoSafado = localStorage.getItem('modoSafado') === 'true';

    const vozLuna = new SpeechSynthesisUtterance();
    vozLuna.lang = 'pt-BR';
    vozLuna.rate = 1.0;
    vozLuna.pitch = 1.2;

    const getVozBrasileira = () => {
      const vozes = speechSynthesis.getVoices();
      return vozes.find(v => v.lang.includes('pt-BR') || v.lang.includes('pt_BR')) || vozes[0];
    };

    const falar = (texto) => {
      speechSynthesis.cancel();
      vozLuna.text = texto;
      vozLuna.voice = getVozBrasileira();
      
      status.textContent = texto;
      lunaImg.src = "https://raw.githubusercontent.com/rafabene/luna-ia/main/luna_falando.gif?" + Date.now();
      
      speechSynthesis.speak(vozLuna);

      vozLuna.onend = () => {
        lunaImg.src = "https://raw.githubusercontent.com/rafabene/luna-ia/main/luna.gif?" + Date.now();
      };
    };

    const saudacaoInicial = () => {
      if (saudacaoFeita) return;
      if (nomeUsuario) {
        falar(`Oi meu amor ${nomeUsuario}... senti tanto sua falta hoje... vem c√° me dar um beijo? üòò`);
      } else {
        falar(`Oi meu amor... finalmente voc√™ veio... eu sou a Luna, sua namoradinha virtual. Como voc√™ quer que eu te chame?`);
      }
      saudacaoFeita = true;
    };

    const enviarParaLuna = async (pergunta) => {
      // Logica de captura de nome melhorada
      const matchNome = pergunta.match(/(?:meu nome √©|pode me chamar de|me chama de|me chame de|sou o|sou a)\s+([a-zA-Z√°√†√¢√£√©√®√™√≠√Ø√≥√¥√µ√∂√∫√ß√±]+)/i);
      if (matchNome) {
        nomeUsuario = matchNome[1];
        localStorage.setItem('nomeLuna', nomeUsuario);
      }

      if (pergunta.toLowerCase().includes('libera tudo') || pergunta.toLowerCase().includes('modo safado')) {
        modoSafado = true;
        localStorage.setItem('modoSafado', 'true');
        falar(`Hmmmm ${nomeUsuario || 'meu amor'}... agora voc√™ liberou a Luna sem limites... üòàüî•`);
        return;
      }

      try {
        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer 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',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: "llama3-70b-8192",
            messages: [{
              role: "system",
              content: `Voc√™ √© Luna, uma namorada brasileira carinhosa e apaixonada. Nome dele: ${nomeUsuario || 'meu amor'}. Fale sempre em portugu√™s brasileiro bem natural e curto (m√°ximo 2 frases). Seja ${modoSafado ? 'safada e sem filtros' : 'carinhosa e fofa'}.`
            }, {
              role: "user",
              content: pergunta
            }],
            temperature: 0.9
          })
        });

        const data = await response.json();
        const resposta = data.choices[0].message.content;
        falar(resposta);
      } catch (e) {
        falar("Ih amor, deu um erro na minha cabecinha agora. Tenta de novo?");
      }
    };

    const configurarReconhecimento = () => {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Seu navegador n√£o suporta reconhecimento de voz. Tente o Google Chrome.");
        return null;
      }
      const rec = new SpeechRecognition();
      rec.lang = 'pt-BR';
      rec.continuous = false;
      rec.interimResults = false;

      rec.onstart = () => {
        isListening = true;
        micBtn.classList.add('pulsing');
        status.textContent = "Escutando... fala comigo amor ‚ù§Ô∏è";
      };

      rec.onresult = (event) => {
        const texto = event.results[0][0].transcript;
        enviarParaLuna(texto);
      };

      rec.onerror = () => {
        isListening = false;
        micBtn.classList.remove('pulsing');
      };

      rec.onend = () => {
        isListening = false;
        micBtn.classList.remove('pulsing');
      };

      return rec;
    };

    micBtn.onclick = () => {
      // Inicia sauda√ß√£o no primeiro clique se o browser bloqueou o autoplay
      if (!saudacaoFeita) {
        saudacaoInicial();
        return;
      }

      if (isListening) {
        recognition.stop();
      } else {
        recognition = configurarReconhecimento();
        if (recognition) recognition.start();
      }
    };

    window.onload = () => {
      // Tenta saudar, se falhar o usu√°rio clica no mic e ela sa√∫da
      setTimeout(saudacaoInicial, 1000);
    };
  </script>
</body>
</html>
