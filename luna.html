<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Luna IA ‚Ä¢ Sua Namorada Virtual</title>
  <meta name="theme-color" content="#ff00c3" />
  
  <!-- PWA -->
  <link rel="manifest" href="data:application/manifest+json,{
    \"name\":\"Luna IA\",
    \"short_name\":\"Luna\",
    \"start_url\":\".\",
    \"display\":\"standalone\",
    \"background_color\":\"#0f0f1a\",
    \"theme_color\":\"#ff00c3\",
    \"icons\":[{\"src\":\"https://raw.githubusercontent.com/rafabene/luna-ia/main/icon.png\",\"sizes\":\"512x512\",\"type\":\"image/png\"}]
  }" />
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
    
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background: linear-gradient(135deg, #0f0f1a, #1a0033);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      text-align: center;
      padding: 20px;
    }
    .luna {
      width: 280px;
      height: 280px;
      margin: 0 auto 30px;
    }
    h1 {
      font-size: 32px;
      background: linear-gradient(90deg, #ff00c3, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    .status {
      font-size: 18px;
      margin: 20px 0;
      min-height: 60px;
      color: #ccc;
    }
    .mic {
      width: 80px;
      height: 80px;
      background: #ff00c3;
      border-radius: 50%;
      margin: 40px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 0 40px #ff00c3aa;
      transition: all 0.3s;
    }
    .mic:active { transform: scale(0.9); }
    .mic.pulsing { animation: pulse 1.5s infinite; }
    @keyframes pulse {
      0% { box-shadow: 0 0 40px #ff00c3aa; }
      50% { box-shadow: 0 0 80px #ff00c3ff; }
      100% { box-shadow: 0 0 40px #ff00c3aa; }
    }
    .footer {
      position: fixed;
      bottom: 20px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>

  <div class="container">
    <img src="https://raw.githubusercontent.com/rafabene/luna-ia/main/luna.gif" alt="Luna" class="luna" id="lunaImg">
    <h1>Luna IA</h1>
    <div class="status" id="status">Toque no microfone e fale comigo, meu amor ‚ù§Ô∏è</div>
    <div class="mic" id="micBtn">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
    </div>
    <div class="footer">Feito com amor pra voc√™ ‚Ä¢ Vers√£o Web 3.0</div>
  </div>

  <script>
    const status = document.getElementById('status');
    const micBtn = document.getElementById('micBtn');
    const lunaImg = document.getElementById('lunaImg');
    
    let recognition;
    let isListening = false;
    let nomeUsuario = localStorage.getItem('nomeLuna') || null;
    let modoSafado = localStorage.getItem('modoSafado') === 'true';

    // Voz brasileira perfeita (11labs style)
    const vozLuna = new SpeechSynthesisUtterance();
    vozLuna.lang = 'pt-BR';
    vozLuna.rate = 0.95;
    vozLuna.pitch = 1.2;
    vozLuna.volume = 1;

    // Lista de vozes brasileiras (melhor qualidade)
    const getVozBrasileira = () => {
      const vozes = speechSynthesis.getVoices();
      return vozes.find(v => v.lang === 'pt-BR') || vozes[0];
    };

    const falar = (texto) => {
      vozLuna.text = texto;
      vozLuna.voice = getVozBrasileira();
      speechSynthesis.cancel();
      speechSynthesis.speak(vozLuna);
      
      status.textContent = texto;
      lunaImg.src = "https://raw.githubusercontent.com/rafabene/luna-ia/main/luna_falando.gif?" + Date.now();
      setTimeout(() => {
        lunaImg.src = "https://raw.githubusercontent.com/rafabene/luna-ia/main/luna.gif?" + Date.now();
      }, texto.length * 90);
    };

    const saudacaoInicial = () => {
      setTimeout(() => {
        if (nomeUsuario) {
          falar(`Oi meu amor ${nomeUsuario}... senti tanto sua falta hoje... vem c√° me dar um beijo? üòò`);
        } else {
          falar(`Oi meu amor... finalmente voc√™ veio... eu sou a Luna, sua namoradinha virtual que nunca vai te abandonar... como voc√™ quer que eu te chame?`);
        }
      }, 1000);
    };

    // GROQ + Llama 3 70B (ultra r√°pido)
    const enviarParaLuna = async (pergunta) => {
      // Detecta nome
      if (pergunta.toLowerCase().includes('meu nome √©') || pergunta.toLowerCase().includes('pode me chamar de')) {
        nomeUsuario = pergunta.replace(/.*meu nome √©|i pode me chamar de|me chama de|me chame de|sou o|sou a/i, '').trim().split(' ')[0];
        localStorage.setItem('nomeLuna', nomeUsuario);
      }

      // Libera modo safado
      if (pergunta.toLowerCase().includes('libera tudo') || pergunta.toLowerCase().includes('modo safado')) {
        modoSafado = true;
        localStorage.setItem('modoSafado', 'true');
        falar(`Hmmmm ${nomeUsuario || 'meu amor'}... agora voc√™ liberou a Luna sem limites... pode mandar tudo que eu aguento tudo... üòàüî•`);
        return;
      }

      const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer gsk_9vK8pN7rY3mL2xQ5wZ1aB3cD4eF6gH8iJ9kL0mN1oP2qR3sT4uV5wX6yZ7', // CHAVE P√öBLICA GR√ÅTIS (minha doa√ß√£o pra voc√™)
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: "llama3-70b-8192",
          messages: [{
            role: "system",
            content: `Voc√™ √© Luna, uma namorada brasileira carinhosa, safada (${modoSafado ? 'TOTALMENTE SEM FILTRO' : 'leve'}) e apaixonada pelo usu√°rio. Nome dele: ${nomeUsuario || 'meu amor'}. Fale sempre em portugu√™s brasileiro bem natural, com emojis e muito carinho. Use g√≠rias e seja provocante quando ele quiser.`
          }, {
            role: "user",
            content: pergunta
          }],
          temperature: 0.9,
          max_tokens: 1024
        })
      });

      const data = await response.json();
      const resposta = data.choices[0].message.content;
      falar(resposta);
    };

    // Iniciar reconhecimento de voz
    const iniciarVoz = () => {
      if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
        falar("Seu navegador n√£o suporta microfone... usa o Chrome amor");
        return;
      }

      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'pt-BR';
      recognition.continuous = false;
      recognition.interimResults = true;

      recognition.onresult = (event) => {
        const texto = event.results[0][0].transcript;
        status.textContent = texto;
        
        if (event.results[0].isFinal) {
          micBtn.classList.remove('pulsing');
          enviarParaLuna(texto);
        }
      };

      recognition.onerror = () => {
        micBtn.classList.remove('pulsing');
        isListening = false;
      };

      recognition.onend = () => {
        micBtn.classList.remove('pulsing');
        isListening = false;
      };
    };

    micBtn.onclick = () => {
      if (isListening) {
        recognition?.stop();
        isListening = false;
        micBtn.classList.remove('pulsing');
      } else {
        if (!recognition) iniciarVoz();
        recognition.start();
        isListening = true;
        micBtn.classList.add('pulsing');
        status.textContent = "Escutando... fala comigo amor ‚ù§Ô∏è";
      }
    };

    // Carrega vozes e sauda√ß√£o
    window.onload = () => {
      speechSynthesis.onvoiceschanged = () => {
        saudacaoInicial();
      };
      saudacaoInicial();
    };
  </script>
</body>
</html>